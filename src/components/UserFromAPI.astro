---
// Fetch user info from API route
// This runs on the server, and cookies are automatically passed
const apiUrl = new URL('/api/user', Astro.url.origin);
const response = await fetch(apiUrl, {
  headers: {
    // Forward cookies from the current request
    cookie: Astro.request.headers.get('cookie') || '',
  },
});
const data = await response.json();
---

<div class="border border-blue-500 rounded p-4">
  <p class="font-semibold mb-2">ðŸ“¡ Fetched from API</p>
  <div class="text-sm space-y-1">
    <p class="text-gray-600">
      <span class="font-mono bg-gray-100 px-1 rounded">GET /api/user</span>
    </p>
    {data.authenticated ? (
      <p class="text-green-700">
        User ID: <code class="bg-green-100 px-1 rounded font-mono">{data.userId}</code>
      </p>
    ) : (
      <p class="text-gray-600">Not authenticated</p>
    )}
    <p class="text-xs text-gray-500 mt-2">
      âœ“ Cookies automatically passed server-to-server
    </p>
  </div>
</div>
